name: test-ec2-playlist
systems:
  - name: s1
    host: ec2
    base: standard-8-vcpu-latest.yml
    overrides:
      hardware:
        rabbitmq:
          volume-config: 1-gp2-1000
          count: 3
    run: 1
common-workload:
  topology:
    file: point-to-point/point-to-point-safe.yml
    variables:
      queues: 1
      consumers: 1
  policies:
    file: mirrored-queue.yml
    variables:
      ha-mode: exactly
      ha-params: 2
  broker-actions:
    action-type: traffic-control
    trigger-type: seconds
    trigger-value: 300
    traffic-control:
      apply-to-client-traffic: true
      apply-to-all-brokers: true
      # delay-ms: 0
      # delay-jtter-ms: 0
      # delay-distribution: none
      # bandwidth: 0,
      packet-loss-mode: random
      packet-loss-arg1: 10%
  client-config:
    tcp-no-delay: false
    publisher-connect-mode: random
    consumer-connect-mode: random
    publisher-heartbeat-seconds: 10
    consumer-heartbeat-seconds: 10
  loadgen-config:
    mode: benchmark
    grace-period-seconds: 60
    warm-up-seconds: 60
    checks:
      - dataloss
      - ordering
      - duplicates
      - availability
  rabbitmq:
    config:
      standard:
        log_level: info
benchmarks:
  - workload:
      topology:
        variables:
          publishers: 1
  - workload:
      topology:
        variables:
          publishers: 2
  - workload:
      topology:
        variables:
          publishers: 4
  - workload:
      topology:
        variables:
          publishers: 8