create table benchmark
(
	benchmark_id uuid not null
		constraint benchmark_pk1
			primary key,
	run_id text not null,
	topology_name text not null,
	benchmark_type text not null,
	dimensions text not null,
	description text not null,
	run_tag text not null,
	config_tag text not null,
	node text not null,
	technology text not null,
	broker_version text not null,
	instance text not null,
	volume text not null,
	filesystem text not null,
	tenancy text not null,
	core_count smallint not null,
	threads_per_core smallint not null,
	hosting text not null,
	start_time timestamp not null,
	start_ms bigint not null,
	end_time timestamp,
	end_ms bigint,
	topology json,
	run_ordinal integer,
	policies json,
	tags text,
	arguments text
);

CREATE TABLE STEP (
    BENCHMARK_ID UUID NOT NULL,
    STEP SMALLINT NOT NULL,
    STEP_VALUE VARCHAR(200) NULL,
    DURATION_SECONDS INT NOT NULL,
    RECORDING_SECONDS INT NULL,
    SENT_COUNT BIGINT NULL,
    SENT_BYTES_COUNT BIGINT NULL,
    RECEIVE_COUNT BIGINT NULL,
    RECEIVE_BYTES_COUNT BIGINT NULL,
    LATENCY_MS_MIN FLOAT(2) NULL,
    LATENCY_MS_50 FLOAT(2) NULL,
    LATENCY_MS_75 FLOAT(2) NULL,
    LATENCY_MS_95 FLOAT(2) NULL,
    LATENCY_MS_99 FLOAT(2) NULL,
    LATENCY_MS_999 FLOAT(2) NULL,
    LATENCY_MS_MAX FLOAT(2) NULL,
    CONFIRM_LATENCY_MS_MIN FLOAT(2) NULL,
    CONFIRM_LATENCY_MS_50 FLOAT(2) NULL,
    CONFIRM_LATENCY_MS_75 FLOAT(2) NULL,
    CONFIRM_LATENCY_MS_95 FLOAT(2) NULL,
    CONFIRM_LATENCY_MS_99 FLOAT(2) NULL,
    CONFIRM_LATENCY_MS_999 FLOAT(2) NULL,
    CONFIRM_LATENCY_MS_MAX FLOAT(2) NULL,
    SEND_RATE_MIN FLOAT(2) NULL,
    SEND_RATE_AVG FLOAT(2) NULL,
    SEND_RATE_MED FLOAT(2) NULL,
    SEND_RATE_STDDEV FLOAT(2) NULL,
    SEND_RATE_MAX FLOAT(2) NULL,
    RECEIVE_RATE_MIN FLOAT(2) NULL,
    RECEIVE_RATE_AVG FLOAT(2) NULL,
    RECEIVE_RATE_MED FLOAT(2) NULL,
    RECEIVE_RATE_STDDEV FLOAT(2) NULL,
    RECEIVE_RATE_MAX FLOAT(2) NULL,
    PER_PUBLISHER_RATE_MIN FLOAT(2) NULL,
    PER_PUBLISHER_RATE_5 FLOAT(2) NULL,
    PER_PUBLISHER_RATE_25 FLOAT(2) NULL,
    PER_PUBLISHER_RATE_50 FLOAT(2) NULL,
    PER_PUBLISHER_RATE_75 FLOAT(2) NULL,
    PER_PUBLISHER_RATE_95 FLOAT(2) NULL,
    PER_PUBLISHER_RATE_MAX FLOAT(2) NULL,
    PER_CONSUMER_RATE_MIN FLOAT(2) NULL,
    PER_CONSUMER_RATE_5 FLOAT(2) NULL,
    PER_CONSUMER_RATE_25 FLOAT(2) NULL,
    PER_CONSUMER_RATE_50 FLOAT(2) NULL,
    PER_CONSUMER_RATE_75 FLOAT(2) NULL,
    PER_CONSUMER_RATE_95 FLOAT(2) NULL,
    PER_CONSUMER_RATE_MAX FLOAT(2) NULL,
    START_TIME TIMESTAMP NOT NULL,
    START_MS BIGINT NOT NULL,
    END_TIME TIMESTAMP NULL,
    END_MS BIGINT NULL,
    PRIMARY KEY(BENCHMARK_ID, STEP)
);

CREATE TABLE VIOLATIONS (
    BENCHMARK_ID UUID NOT NULL,
    VIOLATION_ID SERIAL,
    VIOLATION_TYPE VARCHAR(100) NOT NULL,
    STREAM INT NOT NULL,
    SEQ_NO BIGINT NOT NULL,
    TS BIGINT NOT NULL,
    PRIOR_STREAM INT NULL,
    PRIOR_SEQ_NO BIGINT NULL,
    PRIOR_TS BIGINT NULL,
    PRIMARY KEY(BENCHMARK_ID, VIOLATION_ID)
);

CREATE TABLE CONSUME_INTERVALS (
    BENCHMARK_ID UUID NOT NULL,
    INTERVAL_ID SERIAL,
    CONSUMER_ID varchar(100),
    VHOST varchar(100) not null,
    QUEUE varchar(100) not null,
    START_TIME timestamp not null,
	START_MS bigint not null,
	END_TIME timestamp null,
	END_MS bigint null,
	PRIMARY KEY(BENCHMARK_ID, INTERVAL_ID)
);
